")
print(f"
print(file_content.strip())

# Folder: backend/user_account_management/services/
# File: password_reset_service.py
file_content = 
# Epic Title: User Account Management

import secrets
from datetime import datetime
from backend.user_account_management.repositories.user_repository import UserRepository
from backend.user_account_management.repositories.password_reset_token_repository import PasswordResetTokenRepository
from backend.user_account_management.models.password_reset_token import PasswordResetToken
from backend.user_account_management.models.user import User
from werkzeug.security import generate_password_hash

class PasswordResetService:
    def __init__(self, user_repository: UserRepository = UserRepository(), token_repository: PasswordResetTokenRepository = PasswordResetTokenRepository()):
        self.user_repository = user_repository
        self.token_repository = token_repository

    def initiate_password_reset(self, email: str):
        user = self.user_repository.get_user_by_email(email)
        if not user:
            raise ValueError("Email not found")

        token = secrets.token_urlsafe()
        password_reset_token = PasswordResetToken(user_id=user.id, token=token)
        self.token_repository.add_token(password_reset_token)
        self.send_reset_email(email, token)

    def send_reset_email(self, email: str, token: str):
        # This method would contain logic to send an email to the user with the password reset link
        print(f"Send email to {email} with token {token}")

    def reset_password(self, token: str, new_password: str):
        reset_token = self.token_repository.get_token(token)
        if not reset_token or reset_token.is_expired():
            raise ValueError("Invalid or expired token")

        user = reset_token.user
        user.password_hash = generate_password_hash(new_password)
        self.user_repository.add_user(user)
        # Optionally, delete the token after successful password reset
        self.token_repository.session.delete(reset_token)
        self.token_repository.session.commit()


memory_ledger["emitted_file_paths"].append(f"{folder_mapping}services/password_reset_service.py")
memory_ledger["folder_file_mapping"][f"{folder_mapping}services/"].append("password_reset_service.py")

print("