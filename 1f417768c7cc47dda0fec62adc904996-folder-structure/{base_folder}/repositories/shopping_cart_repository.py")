")
print(f"
print(file_content.strip())

# Folder: backend/shopping_cart_functionality/services/
# File: shopping_cart_service.py
file_content = 
# Epic Title: Shopping Cart Functionality

from backend.shopping_cart_functionality.repositories.shopping_cart_repository import ShoppingCartRepository
from backend.product_catalog_management.repositories.product_repository import ProductRepository
from backend.shopping_cart_functionality.models.shopping_cart import ShoppingCart
from backend.shopping_cart_functionality.models.shopping_cart_item import ShoppingCartItem

class ShoppingCartService:
    def __init__(self, shopping_cart_repository: ShoppingCartRepository = ShoppingCartRepository(), product_repository: ProductRepository = ProductRepository()):
        self.shopping_cart_repository = shopping_cart_repository
        self.product_repository = product_repository

    def add_product_to_cart(self, user_id: int, product_id: int, quantity: int):
        if quantity <= 0:
            raise ValueError("Quantity must be a positive number")

        product = self.product_repository.get_product_by_id(product_id)
        if not product:
            raise ValueError("Product not found")

        cart = self.shopping_cart_repository.get_cart_by_user_id(user_id)
        if not cart:
            cart = self.shopping_cart_repository.create_cart(user_id)
        
        self.shopping_cart_repository.add_cart_item(cart.id, product_id, quantity)

    def get_cart_items(self, user_id: int):
        cart = self.shopping_cart_repository.get_cart_by_user_id(user_id)
        if not cart:
            return []
        return self.shopping_cart_repository.get_cart_items(cart.id)
    
    def remove_cart_item(self, user_id: int, item_id: int):
        cart = self.shopping_cart_repository.get_cart_by_user_id(user_id)
        if not cart:
            raise ValueError("Cart not found")
        if not self.shopping_cart_repository.remove_cart_item(item_id):
            raise ValueError("Item not found in the cart")

    def get_total_cart_price(self, user_id: int) -> float:
        total = 0
        cart = self.shopping_cart_repository.get_cart_by_user_id(user_id)
        if cart:
            items = self.shopping_cart_repository.get_cart_items(cart.id)
            for item in items:
                total += item.quantity * item.product.price
        return total


memory_ledger["emitted_file_paths"].append(f"{base_folder}/services/shopping_cart_service.py")
memory_ledger["folder_file_mapping"][f"{base_folder}/services/"].append("shopping_cart_service.py")

print("