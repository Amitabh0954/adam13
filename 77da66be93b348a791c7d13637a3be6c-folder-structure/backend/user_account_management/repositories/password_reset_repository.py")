")
print("
print(file_content.strip())

# Folder: backend/user_account_management/services/
# File: password_reset_service.py
file_content = 
# Epic Title: User Account Management

import secrets
import string
from datetime import datetime
from backend.user_account_management.repositories.password_reset_repository import PasswordResetRepository
from backend.user_account_management.repositories.user_repository import UserRepository
from backend.user_account_management.models.password_reset_token import PasswordResetToken

class PasswordResetService:
    def __init__(self, password_reset_repository: PasswordResetRepository = PasswordResetRepository(),
                 user_repository: UserRepository = UserRepository()):
        self.password_reset_repository = password_reset_repository
        self.user_repository = user_repository

    def generate_reset_token(self, email: str) -> str:
        user = self.user_repository.get_user_by_email(email)
        if not user:
            raise ValueError("Email not found")

        token = ''.join(secrets.choice(string.ascii_letters + string.digits) for _ in range(20))
        reset_token = PasswordResetToken.generate_token(user_id=user.id, token=token)
        self.password_reset_repository.add_token(reset_token)
        return token

    def verify_reset_token(self, token: str) -> bool:
        reset_token = self.password_reset_repository.get_token(token)
        if reset_token and reset_token.expires_at > datetime.utcnow():
            return True
        return False

    def reset_password(self, token: str, new_password: str):
        reset_token = self.password_reset_repository.get_token(token)
        if not reset_token or reset_token.expires_at <= datetime.utcnow():
            raise ValueError("Invalid or expired token")

        user = reset_token.user
        user.password = new_password
        self.password_reset_repository.session.commit()


memory_ledger["emitted_file_paths"].append("backend/user_account_management/services/password_reset_service.py")
memory_ledger["folder_file_mapping"]["backend/user_account_management/services/"] = ["user_service.py", "password_reset_service.py"]

print("