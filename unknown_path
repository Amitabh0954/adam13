# Epic Title: Shopping Cart Functionality

# In-memory ledger initialization
memory_ledger = {
    "emitted_file_paths": [],
    "declared_entities": [],
    "public_interfaces": [],
    "imports": [],
    "folder_file_mapping": {},
    "persistent_fields": {},
    "folder_responsibilities": {
        "backend/shopping_cart_functionality/controllers": "Endpoints related to shopping cart functionality",
        "backend/shopping_cart_functionality/models": "Database models for shopping cart",
        "backend/shopping_cart_functionality/repositories": "Database interaction for shopping cart",
        "backend/shopping_cart_functionality/services": "Business logic for shopping cart"
    }
}

# Declaring new entities and interfaces
memory_ledger["declared_entities"].extend(["ShoppingCart", "ShoppingCartItem", "Product", "User"])
memory_ledger["public_interfaces"].extend(["ShoppingCartRepository", "ShoppingCartService", "shopping_cart_blueprint"])
memory_ledger["imports"].extend([
    "backend.shopping_cart_functionality.models.shopping_cart:ShoppingCart",
    "backend.shopping_cart_functionality.models.shopping_cart_item:ShoppingCartItem",
    "backend.product_catalog_management.models.product:Product",
    "backend.user_account_management.models.user:User",
    "backend.shopping_cart_functionality.repositories.shopping_cart_repository:ShoppingCartRepository",
    "backend.shopping_cart_functionality.services.shopping_cart_service:ShoppingCartService"
])

# Folder file mapping
base_folder = "backend/shopping_cart_functionality"
memory_ledger["folder_file_mapping"] = {
    f"{base_folder}/controllers/": ["shopping_cart_controller.py"],
    f"{base_folder}/models/": ["shopping_cart.py", "shopping_cart_item.py"],
    f"{base_folder}/repositories/": ["shopping_cart_repository.py"],
    f"{base_folder}/services/": ["shopping_cart_service.py"]
}

# Folder: backend/shopping_cart_functionality/controllers/
# File: shopping_cart_controller.py
file_content = 
# Epic Title: Shopping Cart Functionality

from flask import Blueprint, request, jsonify
from flask_login import login_required, current_user
from backend.shopping_cart_functionality.services.shopping_cart_service import ShoppingCartService

shopping_cart_blueprint = Blueprint('shopping_cart', __name__)
shopping_cart_service = ShoppingCartService()

@shopping_cart_blueprint.route('/add', methods=['POST'])
@login_required
def add_to_cart():
    data = request.json
    product_id = data.get('product_id')
    quantity = data.get('quantity', 1)

    try:
        shopping_cart_service.add_product_to_cart(current_user.id, product_id, quantity)
        return jsonify({'message': 'Product added to cart successfully'}), 201
    except ValueError as e:
        return jsonify({'error': str(e)}), 400

@shopping_cart_blueprint.route('/items', methods=['GET'])
@login_required
def get_cart_items():
    items = shopping_cart_service.get_cart_items(current_user.id)
    return jsonify([item.to_dict() for item in items]), 200

@shopping_cart_blueprint.route('/remove/<int:item_id>', methods=['DELETE'])
@login_required
def remove_from_cart(item_id):
    try:
        shopping_cart_service.remove_cart_item(current_user.id, item_id)
        return jsonify({'message': 'Product removed from cart successfully'}), 200
    except ValueError as e:
        return jsonify({'error': str(e)}), 400

@shopping_cart_blueprint.route('/total_price', methods=['GET'])
@login_required
def get_total_price():
    total_price = shopping_cart_service.get_total_cart_price(current_user.id)
    return jsonify({'total_price': total_price}), 200


memory_ledger["emitted_file_paths"].append(f"{base_folder}/controllers/shopping_cart_controller.py")
memory_ledger["folder_file_mapping"][f"{base_folder}/controllers/"].append("shopping_cart_controller.py")

print("