# Epic Title: Product Catalog Management

# In-memory ledger initialization
memory_ledger = {
    "emitted_file_paths": [],
    "declared_entities": [],
    "public_interfaces": [],
    "imports": [],
    "folder_file_mapping": {},
    "persistent_fields": {},
    "folder_responsibilities": {
        "backend/product_catalog_management/controllers": "Endpoints related to product catalog",
        "backend/product_catalog_management/models": "Database models for product catalog",
        "backend/product_catalog_management/repositories": "Database interaction for products",
        "backend/product_catalog_management/services": "Business logic for products"
    }
}

# Declaring new entities and interfaces
memory_ledger["declared_entities"].extend(["Product", "Category"])
memory_ledger["public_interfaces"].extend(["ProductRepository", "ProductService", "product_blueprint"])
memory_ledger["imports"].extend([
    "backend.product_catalog_management.models.product:Product",
    "backend.product_catalog_management.models.category:Category",
    "backend.product_catalog_management.repositories.product_repository:ProductRepository",
    "backend.product_catalog_management.services.product_service:ProductService"
])

# Folder file mapping
base_folder = "backend/product_catalog_management"
memory_ledger["folder_file_mapping"] = {
    f"{base_folder}/controllers/": ["product_controller.py"],
    f"{base_folder}/models/": ["product.py", "category.py"],
    f"{base_folder}/repositories/": ["product_repository.py"],
    f"{base_folder}/services/": ["product_service.py"]
}

# Folder: backend/product_catalog_management/controllers/
# File: product_controller.py
file_content = 
# Epic Title: Product Catalog Management

from flask import Blueprint, request, jsonify
from backend.product_catalog_management.services.product_service import ProductService

product_blueprint = Blueprint('product', __name__)
product_service = ProductService()

@product_blueprint.route('/add', methods=['POST'])
def add_product():
    data = request.json
    name = data.get('name')
    price = data.get('price')
    description = data.get('description')
    category_id = data.get('category_id')

    try:
        product_service.add_product(name, price, description, category_id)
        return jsonify({'message': 'Product added successfully'}), 201
    except ValueError as e:
        return jsonify({'error': str(e)}), 400

@product_blueprint.route('/update/<int:product_id>', methods=['PUT'])
def update_product(product_id):
    data = request.json
    name = data.get('name')
    price = data.get('price')
    description = data.get('description')
    category_id = data.get('category_id')

    try:
        product_service.update_product(product_id, name, price, description, category_id)
        return jsonify({'message': 'Product updated successfully'}), 200
    except ValueError as e:
        return jsonify({'error': str(e)}), 400

@product_blueprint.route('/delete/<int:product_id>', methods=['DELETE'])
def delete_product(product_id):
    try:
        product_service.delete_product(product_id)
        return jsonify({'message': 'Product deleted successfully'}), 200
    except ValueError as e:
        return jsonify({'error': str(e)}), 400

@product_blueprint.route('/search', methods=['GET'])
def search_products():
    query = request.args.get('query', '')
    page = int(request.args.get('page', 1))
    limit = int(request.args.get('limit', 10))
    products = product_service.search_products(query, page, limit)

    return jsonify([product.to_dict() for product in products]), 200

@product_blueprint.route('/products', methods=['GET'])
def get_products():
    products = product_service.get_all_products()
    return jsonify([product.to_dict() for product in products]), 200


memory_ledger["emitted_file_paths"].append(f"{base_folder}/controllers/product_controller.py")
memory_ledger["folder_file_mapping"][f"{base_folder}/controllers/"].append("product_controller.py")

print("