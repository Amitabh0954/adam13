")
print(f"
print(file_content.strip())

# Folder: backend/user_account_management/services/
# File: password_reset_service.py
file_content = 
# Epic Title: User Account Management

from datetime import datetime
from backend.user_account_management.repositories.user_repository import UserRepository
from backend.user_account_management.repositories.password_reset_repository import PasswordResetRepository
from backend.user_account_management.models.password_reset_token import PasswordResetToken
from werkzeug.security import generate_password_hash
import secrets

class PasswordResetService:
    def __init__(self, user_repository: UserRepository = UserRepository(), password_reset_repository: PasswordResetRepository = PasswordResetRepository()):
        self.user_repository = user_repository
        self.password_reset_repository = password_reset_repository
    
    def initiate_password_reset(self, email: str):
        user = self.user_repository.get_user_by_email(email)
        if not user:
            raise ValueError("Email not found")
        
        token = secrets.token_hex(16)
        password_reset_token = PasswordResetToken(user_id=user.id, token=token)
        self.password_reset_repository.add_password_reset_token(password_reset_token)
        
        # Here you would send the email with the reset link
        self.send_reset_email(email, token)

    def reset_password(self, token: str, new_password: str):
        password_reset_token = self.password_reset_repository.get_password_reset_token(token)
        if not password_reset_token or password_reset_token.expires_at < datetime.utcnow():
            raise ValueError("Invalid or expired token")
        
        user = password_reset_token.user
        user.password_hash = generate_password_hash(new_password)
        self.user_repository.add_user(user) # Assuming this updates the user

        self.password_reset_repository.delete_password_reset_token(password_reset_token)

    def send_reset_email(self, email: str, token: str):
        # Placeholder for email sending logic
        print(f"Email sent to {email} with token {token}")


memory_ledger["emitted_file_paths"].append(f"{base_folder}/services/password_reset_service.py")
memory_ledger["folder_file_mapping"][f"{base_folder}/services/"].append("password_reset_service.py")

print("